## Get all the critical vulnerabilities on ACTIVE devices
```
DeviceInfo
    //Les postes de travail actif et onboardé sont les seuls à être pris en compte
    | where OnboardingStatus=="Onboarded" and SensorHealthState =="Active" 
    | summarize arg_max(Timestamp, *) by DeviceId
    | join(
        DeviceTvmSoftwareVulnerabilities
                    | where VulnerabilitySeverityLevel == "Critical"
        ) on DeviceId
    | project DeviceName, OSPlatform, CveId, SoftwareVendor, SoftwareName, SoftwareVersion, VulnerabilitySeverityLevel, Timestamp, DeviceId, ClientVersion, OSBuild, LoggedOnUsers, RegistryDeviceTag, OSVersion, OnboardingStatus, DeviceType, OSDistribution, OSVersionInfo, SensorHealthState
```

## Get the critical vulnerabilities and the number of times they appear in the parc
##### The CVEs can be writen multiple times if they are associated to different SoftwareName (exemple: Windows10, Windows 11, WindowsServer2012, WindowsServer2016 etc...). To get the CVE one time, remove SoftwareName on the project and summarize request
```
DeviceInfo
    //Les postes de travail actif et onboardé sont les seuls à être pris en compte
    | where OnboardingStatus=="Onboarded" and SensorHealthState =="Active" 
    | summarize arg_max(Timestamp, *) by DeviceId
    | join(
        DeviceTvmSoftwareVulnerabilities
                    | where VulnerabilitySeverityLevel == "Critical"
        ) on DeviceId
    | project CveId, SoftwareVendor, SoftwareName, SoftwareVersion, VulnerabilitySeverityLevel
    | summarize Count=count() by CveId, SoftwareName, SoftwareVendor, VulnerabilitySeverityLevel
    | sort by Count desc 
```
